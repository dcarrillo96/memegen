<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Overlay App</title>
  
  <!-- Add error handling for script loading -->
  <script>
    window.addEventListener('error', function(e) {
      console.error('Script error:', e);
      document.getElementById('error-message').style.display = 'block';
      document.getElementById('error-details').textContent = 'Error: ' + e.message;
    }, true);
  </script>
  
  <!-- Load scripts with error handling -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js" crossorigin></script>
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js" crossorigin></script>
  
  <style>
    /* Reset and base styles */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      color: #333;
      background: #f5f5f5;
    }
    
    /* Error message display */
    #error-message {
      display: none;
      background: #fee;
      border: 1px solid #f99;
      padding: 10px;
      margin: 20px;
      border-radius: 4px;
    }
    
    /* Rest of the styles remain the same */
    /* App container */
    #video-overlay-app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .app-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    
    @media (min-width: 1024px) {
      .app-container {
        flex-direction: row;
        align-items: flex-start;
      }
    }
    
    /* Controls panel */
    .controls-panel {
      flex: 1;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      min-height: 580px;
    }
    
    .panel-header {
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 12px;
      margin-bottom: 16px;
    }
    
    .panel-title {
      font-size: 20px;
      font-weight: 700;
    }
    
    .input-group {
      margin-bottom: 16px;
    }
    
    .input-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
    }
    
    .text-input, 
    .file-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .range-input {
      width: 100%;
    }
    
    .range-label {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
    }
    
    .color-input {
      width: 40px;
      height: 40px;
      padding: 0;
      border: 0;
    }
    
    .color-display {
      font-size: 12px;
      margin-left: 8px;
    }
    
    .color-container {
      display: flex;
      align-items: center;
    }
    
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .download-btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: auto;
    }
    
    .download-btn:hover {
      background: #1d4ed8;
    }
    
    /* Preview area */
    .preview-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .preview-title {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .video-frame {
      position: relative;
      width: 320px;
      background: black;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .video-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .video-element {
      width: 100%;
      object-fit: contain;
    }
    
    .text-overlay {
      position: absolute;
      width: 100%;
      text-align: center;
      font-weight: 700;
      padding: 0 8px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
      bottom: calc(100% + 10px);
      word-break: break-word;
    }
    
    .logo-overlay {
      position: absolute;
      display: flex;
      justify-content: center;
      width: 100%;
      top: calc(100% + 10px);
    }
    
    .placeholder-message {
      color: #9ca3af;
      text-align: center;
      padding: 16px;
    }
    
    .placeholder-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 8px;
    }
    
    .help-text {
      font-size: 12px;
      color: #6b7280;
      margin-top: 16px;
      text-align: center;
      max-width: 300px;
    }
    
    /* Push content to bottom */
    .spacer {
      flex-grow: 1;
    }
  </style>
</head>
<body>
  <!-- Simple error message for display -->
  <div id="error-message">
    <h3>There was a problem loading the application</h3>
    <p id="error-details"></p>
    <p>Try refreshing the page or check the browser console for details.</p>
  </div>

  <!-- Loading indicator -->
  <div id="loading" style="text-align: center; padding: 40px;">
    Loading application...
  </div>
  
  <!-- App container -->
  <div id="video-overlay-app" style="display: none;"></div>

  <!-- Script with error handling -->
  <script type="text/babel">
    // Hide loading when React is ready
    document.getElementById('loading').style.display = 'none';
    document.getElementById('video-overlay-app').style.display = 'block';
    
    // Check if React is defined
    if (typeof React === 'undefined') {
      console.error('React is not defined');
      document.getElementById('error-message').style.display = 'block';
      document.getElementById('error-details').textContent = 'Error: React library failed to load';
      throw new Error('React is not defined');
    }
    
    // Main app component
    const VideoOverlayApp = () => {
      const [videoFile, setVideoFile] = React.useState(null);
      const [text, setText] = React.useState('Sample Overlay Text');
      const [textColor, setTextColor] = React.useState('#FFFFFF');
      const [textSize, setTextSize] = React.useState(17);
      const [logoSize, setLogoSize] = React.useState(120);
      const [showControls, setShowControls] = React.useState(true);
      
      const videoRef = React.useRef(null);
      const frameRef = React.useRef(null);
      
      // Use a hosted placeholder image or upload your own
      const logo = "https://via.placeholder.com/250x100";
      
      const handleVideoUpload = (e) => {
        try {
          const file = e.target.files[0];
          if (file) {
            setVideoFile(URL.createObjectURL(file));
          }
        } catch (err) {
          console.error('Error uploading video:', err);
          alert('Error uploading video: ' + err.message);
        }
      };
      
      const captureScreenshot = () => {
        try {
          if (!window.html2canvas) {
            alert("Screenshot library not loaded. Please refresh and try again.");
            return;
          }
          
          // Hide video controls before capture
          setShowControls(false);
          
          // Wait for state update to propagate
          setTimeout(() => {
            html2canvas(frameRef.current).then(canvas => {
              const link = document.createElement('a');
              link.download = 'video-overlay.png';
              link.href = canvas.toDataURL('image/png');
              link.click();
              
              // Restore controls
              setShowControls(true);
            }).catch(err => {
              console.error("Screenshot failed:", err);
              setShowControls(true);
              alert("Screenshot failed. Please try again.");
            });
          }, 100);
        } catch (err) {
          console.error('Error capturing screenshot:', err);
          setShowControls(true);
          alert('Error capturing screenshot: ' + err.message);
        }
      };
      
      return (
        <div className="app-container">
          {/* Controls Panel */}
          <div className="controls-panel">
            <div className="panel-header">
              <h2 className="panel-title">Video Overlay Editor</h2>
            </div>
            
            <div className="input-group">
              <label className="input-label">Upload Video</label>
              <input 
                type="file" 
                accept="video/*" 
                onChange={handleVideoUpload}
                className="file-input" 
              />
            </div>
            
            <div className="input-group">
              <label className="input-label">Text Overlay</label>
              <input
                type="text"
                placeholder="Enter text overlay..."
                value={text}
                onChange={(e) => setText(e.target.value)}
                className="text-input"
              />
            </div>
            
            <div className="grid-2">
              <div className="input-group">
                <label className="input-label">Text Color</label>
                <div className="color-container">
                  <input
                    type="color"
                    value={textColor}
                    onChange={(e) => setTextColor(e.target.value)}
                    className="color-input"
                  />
                  <span className="color-display">{textColor}</span>
                </div>
              </div>
              
              <div className="input-group">
                <label className="input-label">Text Size: {textSize}px</label>
                <input
                  type="range"
                  min="12"
                  max="48"
                  value={textSize}
                  onChange={(e) => setTextSize(Number(e.target.value))}
                  className="range-input"
                />
              </div>
            </div>
            
            <div className="input-group">
              <label className="input-label">Logo Size: {logoSize}px</label>
              <input
                type="range"
                min="32"
                max="180"
                step="4"
                value={logoSize}
                onChange={(e) => setLogoSize(Number(e.target.value))}
                className="range-input"
              />
            </div>
            
            <div className="spacer"></div>
            
            <button 
              onClick={captureScreenshot} 
              className="download-btn"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Download Video
            </button>
          </div>
          
          {/* Preview */}
          <div className="preview-container">
            <h3 className="preview-title">Preview</h3>
            
            {/* Main frame with 16:9 vertical aspect ratio */}
            <div 
              ref={frameRef}
              className="video-frame"
              style={{ height: 'calc(320px * 16/9)' }}
            >
              {/* Video container */}
              <div className="video-container">
                {videoFile ? (
                  <div className="relative">
                    <video 
                      ref={videoRef}
                      src={videoFile}
                      className="video-element" 
                      controls={showControls} 
                      muted 
                      loop
                      autoPlay
                      style={{ width: '100%' }}
                    />
                    
                    {/* Text positioned exactly 10px above the video */}
                    {text && (
                      <div 
                        className="text-overlay"
                        style={{
                          color: textColor,
                          fontSize: `${textSize}px`,
                        }}
                      >
                        {text}
                      </div>
                    )}
                    
                    {/* Logo positioned exactly 10px below the video */}
                    <div className="logo-overlay">
                      <img 
                        src={logo}
                        style={{ width: `${logoSize}px` }}
                        alt="Logo" 
                        onError={(e) => {
                          console.error('Logo failed to load');
                          e.target.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22250%22%20height%3D%22100%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22250%22%20height%3D%22100%22%20fill%3D%22%23eee%22%2F%3E%3Ctext%20x%3D%22125%22%20y%3D%2250%22%20font-size%3D%2216%22%20text-anchor%3D%22middle%22%20alignment-baseline%3D%22middle%22%20fill%3D%22%23aaa%22%3ELogo%3C%2Ftext%3E%3C%2Fsvg%3E';
                        }}
                      />
                    </div>
                  </div>
                ) : (
                  <div className="relative" style={{ width: '100%', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                    <div className="placeholder-message">
                      <svg className="placeholder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1" strokeLinecap="round" strokeLinejoin="round">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                      </svg>
                      Upload a video to see preview
                    </div>
                    
                    {/* Show text in default position when no video */}
                    {text && (
                      <div 
                        className="text-overlay"
                        style={{
                          color: textColor,
                          fontSize: `${textSize}px`,
                          bottom: 'auto',
                          top: '30%'
                        }}
                      >
                        {text}
                      </div>
                    )}
                    
                    {/* Show logo in default position when no video */}
                    <div 
                      className="logo-overlay"
                      style={{
                        top: 'auto',
                        bottom: '30%'
                      }}
                    >
                      <img 
                        src={logo}
                        style={{ width: `${logoSize}px` }}
                        alt="Logo" 
                        onError={(e) => {
                          console.error('Logo failed to load');
                          e.target.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22250%22%20height%3D%22100%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22250%22%20height%3D%22100%22%20fill%3D%22%23eee%22%2F%3E%3Ctext%20x%3D%22125%22%20y%3D%2250%22%20font-size%3D%2216%22%20text-anchor%3D%22middle%22%20alignment-baseline%3D%22middle%22%20fill%3D%22%23aaa%22%3ELogo%3C%2Ftext%3E%3C%2Fsvg%3E';
                        }}
                      />
                    </div>
                  </div>
                )}
              </div>
            </div>
            
            <p className="help-text">
              Frame shown in vertical 16:9 ratio. Text appears 10px above video and logo 10px below.
            </p>
          </div>
        </div>
      );
    };

    // Add error handler for rendering
    try {
      // Render the app
      ReactDOM.render(
        <VideoOverlayApp />,
        document.getElementById('video-overlay-app')
      );
    } catch (err) {
      console.error('Error rendering app:', err);
      document.getElementById('error-message').style.display = 'block';
      document.getElementById('error-details').textContent = 'Error rendering app: ' + err.message;
    }
  </script>
</body>
</html>
